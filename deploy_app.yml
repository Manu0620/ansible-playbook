- name: Administrar servidores en DigitalOcean
  hosts: all
  tasks:
    - name: Obtener el nombre del sistema operativo
      ansible.builtin.setup:
        filter: ansible_distribution

      # Seleccionamos solo el primer elemento de la lista
      register: os_info
      delegate_to: localhost
    
    - name: Arreglar pip
      apt:
        name:
          - python-setuptools
          - python3-pip
        state: latest
        update_cache: yes  # This ensures that the package cache is updated before installing packages
    
    - name: Actualizar Ansible utilizando pip
      pip:
        name: ansible
        state: latest
    
    - name: Clonar repositorio
      git:
        repo: https://github.com/Manu0620/first-rust-app
        dest: /home/mmadera/first-rust-app

    - name: Build and Start Docker container
      shell: |
        cd /home/mmadera/first-rust-app
        docker-compose down
        docker-compose build
        docker-compose up -d
